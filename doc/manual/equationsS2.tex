\documentclass[preprint,12pt]{elsarticle}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{color}
\usepackage{listings}
\usepackage[colorlinks]{hyperref}
\input{newcommands}
\newcommand{\sigsL}{\frac{\sigma_{s,i,L}^k}{2}}
\newcommand{\sigsR}{\frac{\sigma_{s,i,R}^k}{2}}
\newcommand{\sigtL}{\sigma_{t,i,L}^k}
\newcommand{\sigtR}{\sigma_{t,i,R}^k}
\newcommand{\halfh}{\frac{h_i}{2}}

\begin{document}
\tableofcontents
\newpage

%===============================================================================
\section{Introduction}
%===============================================================================

In this work, a new IMEX scheme for solving the equations of radiation
hydrodynamics (RH) that is second-order accurate in both space and time is
presented and tested. A RH system combining a 1-D slab model
of compressible fluid dynamics with a grey radiation S$_2$ model is considered,
given by:
\begin{subequations}
\lequ{radhydro_system}
\be
\dxdy{\rho}{t}+\dxdy{}{x}\fn{\rho u} = 0 \pec
\lequ{cons_mass}
\ee 
\be
\dxdy{}{t}\fn{\rho u} + \dxdy{}{x}\fn{\rho u^2} + \dxdy{}{x}\fn{p}
  = \frac{\sigma_t}{c} \F_0 \pec
\lequ{cons_mom}
\ee
\be
\dxdy{E}{t} + \dxdy{}{x}\bracket{\fn{E+p}u}=-\sigma_a c \fn{aT^4 - \E}
  + \frac{\sigma_t u}{c} \F_0 \pec
\lequ{cons_energy}
\ee
\be
\frac{1}{c}\dxdy{\psi^+}{t} + \frac{1}{\sqrt{3}}\dxdy{\psi^+}{x}
  + \sigma_t \psi^+ = \frac{\sigma_s}{4\pi} c\E + \frac{\sigma_a}{4\pi} acT^4
  - \frac{\sigma_t u}{4\pi c} \F_0 + \frac{\sigma_t}{\sqrt{3}\pi}\E u
\pec
\lequ{intp}
\ee
\be
\frac{1}{c}\dxdy{\psi^-}{t} - \frac{1}{\sqrt{3}}\dxdy{\psi^-}{x}
  + \sigma_t \psi^- = \frac{\sigma_s}{4\pi} c\E + \frac{\sigma_a}{4\pi} acT^4
  - \frac{\sigma_t u}{4\pi c} \F_0 - \frac{\sigma_t}{\sqrt{3}\pi}\E u
\pec
\lequ{intm}
\ee
\end{subequations}
where $\rho$ is the density, $u$ is the velocity,
$E=\rho\fn{\frac{u^2}{2} + e}$ is the total material energy density,
$e$ is the specific internal energy density, $T$ is the material temperature,
$\E$ is the radiation energy density:
\be
\E = \frac{2\pi}{c}\fn{\psi^{+}+\psi^{-}} \pec
\lequ{Erad}
\ee
$\F$ is the radiation energy flux:
\be
\F = \frac{2\pi}{\sqrt{3}}\fn{\psi^{+}-\psi^{-}} \pec
\lequ{flux}
\ee
and $\F_0$ is an approximation to the comoving-frame flux,
\be
\lequ{F_nu_0}
\F_0 = \F-\frac{4}{3} \E u \pep
\ee
Note that multiplying Eqs.~\requ{intp} and \requ{intm} by $2\pi$ and summing
them gives the radiation energy equation:
\begin{subequations}
\be
\dxdy{\E}{t} + \dxdy{\F}{x} = \sigma_a c(aT^4 - \E) - \frac{\sigma_t u}{c}\F_0 \pec
\lequ{erad}
\ee
and multiplying \equ{intp} by $\frac{2\pi}{c\sqrt{3}}$ and \equ{intm} by
$-\frac{2\pi}{c\sqrt{3}}$ and sum them, we get the radiation momentum equation: 
\be
\frac{1}{c^2}\dxdy{\F}{t} + \frac{1}{3}\dxdy{\E}{x} = -\frac{\sigma_t}{c}\F_0 \pep
\ee
\end{subequations}
Equations \requ{cons_mass} through \requ{intm} are closed by assuming an ideal
equation of state (EOS):
\begin{subequations}
\be
p=\rho e (\gamma -1)
\lequ{pressure}
\pec
\ee
\be
T = \frac{e}{c_v} \pec
\lequ{matemp}
\ee
\end{subequations}
where $\gamma$ is the adiabatic index, and $c_v$ is the specific heat capacity.
However, the method presented is compatible with any valid EOS. 

%===============================================================================
\subsection{Source Definitions for the \texorpdfstring{S$_2$}{S-2} Equations}
%===============================================================================

Taking the zeroth angular moment of the S$_2$ equations, given by Equations
\requ{intp} and \requ{intm}, gives
\begin{equation}
\frac{1}{c}\dydt{\phi} + \dydx{\F} + \sigma_t\phi = \sigma_s\phi + Q_0 \pec
\lequ{zerothmoment}
\end{equation}
where $\phi = c\E$ and the source $Q_0$ is
\begin{equation}
Q_0 = \sigma_a acT^4 - \sigma_t\frac{u}{c}\F_0 \pep
\lequ{Q0}
\end{equation}
Taking the first angular moment of the S$_2$ equations gives
\begin{equation}
\frac{1}{c}\dydt{\F} + \dydx{\phi} + \sigma_t\F = Q_1 \pec
\lequ{firstmoment}
\end{equation}
where $Q_1$ is
\begin{equation}
Q_1 = \frac{4}{3}\sigma_t\E u \pep
\lequ{Q1}
\end{equation}
Defining a total source as
\begin{equation}
Q^\pm = Q_0 + 3\mu^\pm Q_1
\lequ{Qdef}
\end{equation}
and making the definitions
\begin{equation}
  \Psi^\pm = 2\pi\psi^\pm
\end{equation}
and
\begin{equation}
  \Q^\pm = \frac{Q^\pm}{2}
\end{equation}
and rewriting the S$_2$ equations gives
% \begin{equation}\lequ{S2Q}
%   \frac{1}{c}\dydt{\psi^\pm} + \mu^\pm\dydx{\psi^\pm} + \sigma_t\psi^\pm
%   = \frac{\sigma_s}{4\pi}\phi + \frac{1}{4\pi}Q^\pm \pec
% \end{equation}
\begin{equation}\lequ{S2Q}
  \frac{1}{c}\dydt{\Psi^\pm} + \mu^\pm\dydx{\Psi^\pm} + \sigma_t\Psi^\pm
  = \frac{\sigma_s}{2}\phi + \Q^\pm \pec
\end{equation}
where $\mu^\pm=\pm\frac{1}{\sqrt{3}}$.

\subsection{Ensuring diffusion limit with correct energy slopes}

To ensure we get the diffusion limit, we need to have slopes defined by the radiation
solver that are independent of the hydro solver.  In reality, in 1D this is not
necessary, but we will implement it as proof of principle for higher dimensions. Because we need to use
old time step values in building our systems, it will be necessary to store the
``radiation" slopes from the previous solves. For example, during the MUSCL solve, we
will just use the standard MUSCL formula and no modifications to the slope. Thus,
E$^*$ is evaluated when evaluating the new
total energies in the equations, we will use the following formula,

%===============================================================================
\section{Solution Overview}
%===============================================================================
The solution for a time step $t\rightarrow t+\dt$ consists of four nonlinear
solves:

\begin{enumerate}
  \item CN from $n$ to $n+\fourth$
  \item CN from $n+\fourth$ to $n+\half$
  \item CN from $n+\half$ to $n+\frac{3}{4}$
  \item TR/BDF-2 from $n+\half$ to $n+1$
\end{enumerate}

%===============================================================================
\section{MUSCL-Hancock Algorithm}
%===============================================================================

The homogeneous Euler equations may be expressed in conservative form as
\begin{equation}
\dydt{\U} + \nabla\cdot\Flux(\U) = \mathbf{0}\quad
\U=\left[\begin{array}{c}\rho\\\rho u\\E\end{array}\right]\quad
\Flux(\U)=\left[\begin{array}{c}\rho u\\
  \rho u^2 + p\\
  (E+p)u\end{array}\right] \pec
\end{equation}
where $\U$ is a vector of the conservative unknowns
and $\Flux(\U)$ is the flux associated with each:
\begin{equation}
\U=\left[\begin{array}{c}\rho\\\rho u\\E\end{array}\right] \pec\qquad
\Flux(\U)=\left[\begin{array}{c}\rho u\\
  \rho u^2 + p\\
  (E+p)u\end{array}\right] \pep
\end{equation}
The first half of a MUSCL-Hancock step $t^n\rightarrow t^n+\dt$
consists of constructing a linear representation of the solution:
\begin{equation}
  \U\iL^n = \U_i^n - \frac{\Delta_i^n}{2} \pec
  \quad
  \U\iR^n = \U_i^n + \frac{\Delta_i^n}{2} \pec
\end{equation}
and then evolving that representation by half a time step:
\begin{equation}
  \U_i^{n+\half} = \U_i^n - \frac{\half\dt}{\dx}
  \left(\Flux(\U\iR^n) - \Flux(\U\iL^n)\right) \pep
\end{equation}
The second half of a MUSCL-Hancock step employs a Riemann solver
to compute the fluxes at time $n+\half$:
\begin{equation}
  \U_i^{n+1} = \U_i^n - \frac{\dt}{\dx}
  \left(\Flux_{i+\half}^{n+\half} - \Flux_{i-\half}^{n+\half}\right)
\end{equation}

%===============================================================================
\section{Spatial Discretization}
%===============================================================================

A lumped linear discontinuous (LLD) spatial discretization is employed
for the S$_2$ equations, so the angular flux
unknowns are the left and right values $\Psi_{i,L}^\pm$ and
$\Psi_{i,R}^\pm$ for each cell $i$. The spatially
discretized equations result from integrating each half cell
$(x_i-\frac{h_i}{2},x_i)$ and $(x_i,x_i+\frac{h_i}{2})$,
where $x_i$ is the cell center, and $h_i$ is the cell width.
The fully discretized equations are given in Section \rsec{full}.

%===============================================================================
\subsection{Steady-State \texorpdfstring{S$_2$}{S-2} Equations}\lsec{S2ssdisc}
%===============================================================================
Using an LLD discretization, the steady-state
S$_2$ equations (obtained by dropping the $\dydt{\Psi^\pm}$ in Equation
\requ{S2Q}) become
%\begin{equation}\lequ{S2ssL}
%  \mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}
%  +\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}=
%  \frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}
%  +\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
%\end{equation}
%\begin{equation}\lequ{S2ssR}
%  \mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}
%  +\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}=
%  \frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}
%  +\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pec
%\end{equation}
\begin{equation}\lequ{S2ssL}
  \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_i - \Psi^{\pm,k+1}_{i-\half}}
  +\sigma_{t,i,L}^k\Psi\iL^{\pm,k+1}
  -\frac{\sigma_{s,i,L}^k}{2}\phi\iL^{k+1}
  =\Q_{i,L}^{\pm,k} \pec
\end{equation}
\begin{equation}\lequ{S2ssR}
  \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_{i+\half} - \Psi^{\pm,k+1}_i}
  +\sigma_{t,i,R}^k\Psi\iR^{\pm,k+1}
  -\frac{\sigma_{s,i,R}^k}{2}\phi\iR^{k+1}
  =\Q_{i,R}^{\pm,k} \pec
\end{equation}
where the cell center and edge fluxes are defined as
%\begin{equation}
%  \psi_i^\pm=\half\fn{\psi_{i,L}^\pm + \psi_{i,R}^\pm} \pec
%\end{equation}
%\begin{equation}
%  \psi_{i+\half}^+=\psi_{i,R}^+ \pec\qquad \psi_{i+\half}^-=\psi_{i+1,L}^- \pep
%\end{equation}
\begin{equation}
  \Psi_i^\pm=\half\fn{\Psi_{i,L}^\pm + \Psi_{i,R}^\pm} \pec
\end{equation}
\begin{equation}
  \Psi_{i+\half}^+=\Psi_{i,R}^+ \pec\qquad \Psi_{i+\half}^-=\Psi_{i+1,L}^- \pep
\end{equation}
Coefficients of the resulting linear system matrix are the following,
where conditions in parentheses indicate when a term does not
apply for the boundary elements $i=1$ and $i=N$:
\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i-1,R,+$ & $i,L,-$ & $i,L,+$\\\hline\hline
  $i,L,-$ &
          & $-\frac{\mu^-}{h_i} + \sigtL - \sigsL$
          & $-\sigsL$ \\\hline
  $i,L,+$ & $-\frac{2\mu^+}{h_i}$ ($i\ne 1$)
          & $-\sigsL$
          & $\frac{\mu^+}{h_i} + \sigtL - \sigsL$ \\\hline
  $i,R,-$ &
          & $-\frac{\mu^-}{h_i}$
          & \\\hline
  $i,R,+$ &
          &
          & $-\frac{\mu^+}{h_i}$ \\\hline
\end{tabular}
\end{center}
\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i,R,-$ & $i,R,+$ & $i+1,L,-$\\\hline\hline
  $i,L,-$ & $\frac{\mu^-}{h_i}$
          &
          & \\\hline
  $i,L,+$ &
          & $\frac{\mu^+}{h_i}$
          & \\\hline
  $i,R,-$ & $-\frac{\mu^-}{h_i} + \sigtR - \sigsR$
          & $-\sigsR$
          & $\frac{2\mu^-}{h_i}$ ($i\ne N$) \\\hline
  $i,R,+$ & $-\sigsR$
          & $\frac{\mu^+}{h_i} + \sigtR - \sigsR$
          & \\\hline
\end{tabular}
\end{center}
The right hand side vector for the linear system is the following,
where the columns indicate to which cell(s) the expressions
correspond:

\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i=1$ & $i=2\ldots N-1$ & $i=N$\\\hline\hline
  $i,L,-$ & $\Q^-_{i,L}$
          & $\Q^-_{i,L}$
          & $\Q^-_{i,L}$ \\\hline
  $i,L,+$ & $\Q^+_{i,L} + \frac{2\mu^+}{h_i}\Psi^+_{inc}$
          & $\Q^+_{i,L}$
          & $\Q^+_{i,L}$ \\\hline
  $i,R,-$ & $\Q^-_{i,R}$
          & $\Q^-_{i,R}$
          & $\Q^-_{i,R} - \frac{2\mu^-}{h_i}\Psi^-_{inc}$ \\\hline
  $i,R,+$ & $\Q^+_{i,R}$
          & $\Q^+_{i,R}$
          & $\Q^+_{i,R}$ \\\hline
\end{tabular}
\end{center}
The incoming boundary fluxes $\Psi^\pm_{inc}$ are computed from the
user-supplied boundary half-range currents $j^\pm$ using quadrature:
\begin{equation}
   j^+(x_L) = 2\pi\int\limits_0^1 \psi(x_L,\mu)\mu d\mu
   \approx \sum\limits_{\mu_d>0}\psi(x_L,\mu_d)\mu_d w_d
   = \mu^+\Psi^+_{inc} \pec
\end{equation}
\begin{equation}
   j^-(x_R) = -2\pi\int\limits_{-1}^0 \psi(x_R,\mu)\mu d\mu
   \approx -\sum\limits_{\mu_d<0}\psi(x_R,\mu_d)\mu_d w_d
   = -\mu^-\Psi^-_{inc} \pep
\end{equation}

Transient S$_2$ solvers can employ a steady-state solver if
the following generalization is made to Equations \requ{S2ssL}
and \requ{S2ssR}:
%\begin{equation}
%  \mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}
%  +\fn{\sigma_{t,i,L}^k + \alpha}\frac{h_i}{2}\psi\iL^{\pm,k+1}=
%  \frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}
%  +\frac{1}{4\pi}\frac{h_i}{2}\tilde{Q}_{i,L}^{\pm,k} \pec
%\lequ{S2trL}
%\end{equation}
%\begin{equation}
%  \mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}
%  +\fn{\sigma_{t,i,R}^k + \alpha}\frac{h_i}{2}\psi\iR^{\pm,k+1}=
%  \frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}
%  +\frac{1}{4\pi}\frac{h_i}{2}\tilde{Q}_{i,R}^{\pm,k} \pec
%\lequ{S2trR}
%\end{equation}
\begin{equation}\lequ{S2trL}
  \beta\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_i - \Psi^{\pm,k+1}_{i-\half}}
  +\fn{\beta\sigma_{t,i,L}^k + \alpha}\Psi\iL^{\pm,k+1}
  -\beta\frac{\sigma_{s,i,L}^k}{2}\phi\iL^{k+1}
  =\tilde{\Q}_{i,L}^{\pm,k} \pec
\end{equation}
\begin{equation}\lequ{S2trR}
  \beta\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_{i+\half} - \Psi^{\pm,k+1}_i}
  +\fn{\beta\sigma_{t,i,R}^k + \alpha}\Psi\iR^{\pm,k+1}
  -\beta\frac{\sigma_{s,i,R}^k}{2}\phi\iR^{k+1}
  =\tilde{\Q}_{i,R}^{\pm,k} \pec
\end{equation}
where $\alpha$, $\beta$, and $\tilde{\Q}^\pm$ depend on the time
discretization used.

%===============================================================================
\section{Temporal Discretization}
%===============================================================================
\subsection{Fluid Momentum Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}
  \frac{\rho^{n+1}\left(u^{k+1}-u^*\right)}{\dt} = 
   \half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
  +\half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{\rho^{n+1}\left(u^{k+1}-u^*\right)}{\half\dt} =  
  & \sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
   +\sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{n+\half}\\
  &+\frac{2}{3}\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{k+1}
  \pep
\end{split}\end{equation}

\subsection{Fluid Energy Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E^{k+1}-E^*}{\dt} = &
  -\half\left[\sigma_{a} c\left(aT^4 - \E\right)\right]^n
  -\half\sigma_{a}^k c\left[aT^4 - \E\right]^{k+1}\\
  &+\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
   +\half\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{split}\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E^{k+1}-E^*}{\half\dt} = &
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]^n
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]^{n+\half}\\
  &-\frac{2}{3}\sigma_a^k c\left[aT^4 - \E\right]^{k+1}
   +\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n\\
  &+\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{n+\half}
   +\frac{2}{3}\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{split}\end{equation}


\subsection{\texorpdfstring{S$_2$}{S-2} Equations}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
Applying the Crank-Nicolson scheme to Equation \requ{S2Q} for a step
$t^n\rightarrow t^{n+1}$, the S-2 equations become
%\begin{equation}\lequ{S2CN}\begin{split}
%  \frac{1}{c}\frac{\psi^{\pm,k+1}-\psi^{\pm,n}}{\dt} = &
%  -\half\mu^\pm\dydx{\psi^{\pm,n}} -\half\mu^\pm\dydx{\psi^{\pm,k+1}}\\
%  &-\half\sigma_t^n\psi^{\pm,n} -\half\sigma_t^k\psi^{\pm,k+1}\\
%  &+\half\frac{\sigma_s^n}{4\pi}\phi^n +\half\frac{\sigma_s^k}{4\pi}\phi^{k+1}\\
%  &+\half\frac{1}{4\pi}Q^{\pm,n} +\half\frac{1}{4\pi}Q^{\pm,k} \pec
%\end{split}\end{equation}
\begin{equation}\lequ{S2CN}\begin{split}
  \frac{1}{c}\frac{\Psi^{\pm,k+1}-\Psi^{\pm,n}}{\dt} = &
  -\half\mu^\pm\dydx{\Psi^{\pm,n}} -\half\mu^\pm\dydx{\Psi^{\pm,k+1}}\\
  &-\half\sigma_t^n\Psi^{\pm,n} -\half\sigma_t^k\Psi^{\pm,k+1}\\
  &+\half\frac{\sigma_s^n}{2}\phi^n +\half\frac{\sigma_s^k}{2}\phi^{k+1}\\
  &+\half\Q^{\pm,n} +\half\Q^{\pm,k} \pec
\end{split}\end{equation}
where $k$ represents the $k$th iteration of a quantity at time $t^{n+1}$.

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
Applying the BDF-2 scheme to Equation \requ{S2Q} for a step
$t^{n}\rightarrow t^{n+1}$, the S-2 equations become
%\begin{equation}\lequ{S2BDF2}\begin{split}
%  \frac{1}{c}\frac{\psi^{\pm,k+1}-\psi^{\pm,n}}{\dt} = &
%  -\sixth\mu^\pm\dydx{\psi^{\pm,n-1}}
%  -\sixth\mu^\pm\dydx{\psi^{\pm,n}}
%  -\frac{2}{3}\mu^\pm\dydx{\psi^{\pm,k+1}}\\
%  &-\sixth\sigma_t^{n-1}\psi^{\pm,n-1}
%   -\sixth\sigma_t^{n}  \psi^{\pm,n}
%   -\frac{2}{3}\sigma_t^k\psi^{\pm,k+1}\\
%  &+\sixth\frac{\sigma_s^{n-1}}{4\pi}\phi^{n-1}
%   +\sixth\frac{\sigma_s^{n}}{4\pi}  \phi^{n}
%   +\frac{2}{3}\frac{\sigma_s^k}{4\pi}\phi^{k+1}\\
%  &+\sixth\frac{1}{4\pi}Q^{\pm,n-1}
%   +\sixth\frac{1}{4\pi}Q^{\pm,n}
%   +\frac{2}{3}\frac{1}{4\pi}Q^{\pm,k} \pec
%\end{split}\end{equation}
\begin{equation}\lequ{S2BDF2}\begin{split}
  \frac{1}{c}\frac{\Psi^{\pm,k+1}-\Psi^{\pm,n}}{\dt} = &
  -\sixth\mu^\pm\dydx{\Psi^{\pm,n-1}}
  -\sixth\mu^\pm\dydx{\Psi^{\pm,n}}
  -\frac{2}{3}\mu^\pm\dydx{\Psi^{\pm,k+1}}\\
  &-\sixth\sigma_t^{n-1}\Psi^{\pm,n-1}
   -\sixth\sigma_t^{n}  \Psi^{\pm,n}
   -\frac{2}{3}\sigma_t^k\Psi^{\pm,k+1}\\
  &+\sixth\frac{\sigma_s^{n-1}}{2}\phi^{n-1}
   +\sixth\frac{\sigma_s^{n}}{2}  \phi^{n}
   +\frac{2}{3}\frac{\sigma_s^k}{2}\phi^{k+1}\\
  &+\sixth\Q^{\pm,n-1}
   +\sixth\Q^{\pm,n}
   +\frac{2}{3}\Q^{\pm,k} \pec
\end{split}\end{equation}
where $k$ represents the $k$th iteration of a quantity at time $t^{n+1}$.

%===============================================================================
\section{Fully Discretized Equations}\lsec{full}
%===============================================================================
\subsection{Fluid Momentum Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}
  \frac{\rho_i^{n+1}\left(u_i^{k+1}-u_i^*\right)}{\dt} = 
   \half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
  +\half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydromCNfull}
\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{\rho_i^{n+1}\left(u_i^{k+1}-u_i^*\right)}{\half\dt} =  
  & \sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
   +\sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{n+\half}\\
  &+\frac{2}{3}\left[\frac{\sigma_{t,i}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{k+1}
  \pep
\lequ{hydromBDF2full}
\end{split}\end{equation}

%-------------------------------------------------------------------------------
\subsection{Fluid Energy Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E_i^{k+1}-E_i^*}{\dt} = &
  -\half\left[\sigma_{a} c\left(aT_i^4 - \E_i\right)\right]_i^n
  -\half\left[\sigma_{a}^k c\left(a(T^{k+1})^4 - \E^{k+1}\right)\right]_i\\
  &+\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
   +\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydroECNfull}
\end{split}\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E_i^{k+1}-E_i^*}{\half\dt} = &
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]_i^n
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]_i^{n+\half}\\
  &-\frac{2}{3}\left[\sigma_a^k c\left(a(T^{k+1})^4 - \E^{k+1}\right)\right]_i
   +\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n\\
  &+\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{n+\half}
   +\frac{2}{3}\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydroEBDF2full}
\end{split}\end{equation}

%-------------------------------------------------------------------------------
\subsection{\texorpdfstring{S$_2$}{S-2} Equations}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}\lsec{S2fullCN}
%-------------------------------------------------------------------------------
The fully discretized S$_2$ equations for a Crank-Nicolson step
$t^n\rightarrow t^{n+1}$ are
%\begin{equation}\lequ{S2CNfullL}\begin{split}
%  \frac{1}{c}\frac{\psi\iL^{\pm,k+1}-\psi\iL^{\pm,n}}{\dt} = &
%  -\half\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}
%  -\half\mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}\\
%  &-\half\sigma_{t,i,L}^n\frac{h_i}{2}\psi\iL^{\pm,n}
%   -\half\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}\\
%  &+\half\frac{\sigma_{s,i,L}^n}{4\pi}\frac{h_i}{2}\phi\iL^n
%   +\half\frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}\\
%  &+\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n}
%   +\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
%\end{split}\end{equation}
\begin{equation}\lequ{S2CNfullL}\begin{split}
  \frac{1}{c}\frac{\Psi\iL^{\pm,k+1}-\Psi\iL^{\pm,n}}{\dt} = &
  -\half\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n}_i - \Psi^{\pm,n}_{i-\half}}
  -\half\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_i - \Psi^{\pm,k+1}_{i-\half}}\\
  &-\half\sigma_{t,i,L}^n\Psi\iL^{\pm,n}
   -\half\sigma_{t,i,L}^k\Psi\iL^{\pm,k+1}\\
  &+\half\frac{\sigma_{s,i,L}^n}{2}\phi\iL^n
   +\half\frac{\sigma_{s,i,L}^k}{2}\phi\iL^{k+1}\\
  &+\half\Q_{i,L}^{\pm,n}
   +\half\Q_{i,L}^{\pm,k} \pec
\end{split}\end{equation}

%\begin{equation}\lequ{S2CNfullR}\begin{split}
%  \frac{1}{c}\frac{\psi\iR^{\pm,k+1}-\psi\iR^{\pm,n}}{\dt} = &
%  -\half\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_i}
%  -\half\mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}\\
%  &-\half\sigma_{t,i,R}^n\frac{h_i}{2}\psi\iR^{\pm,n}
%   -\half\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}\\
%  &+\half\frac{\sigma_{s,i,R}^n}{4\pi}\frac{h_i}{2}\phi\iR^n
%   +\half\frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}\\
%  &+\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n}
%   +\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pep
%\end{split}\end{equation}
\begin{equation}\lequ{S2CNfullR}\begin{split}
  \frac{1}{c}\frac{\Psi\iR^{\pm,k+1}-\Psi\iR^{\pm,n}}{\dt} = &
  -\half\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n}_{i+\half} - \Psi^{\pm,n}_i}
  -\half\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_{i+\half} - \Psi^{\pm,k+1}_i}\\
  &-\half\sigma_{t,i,R}^n\Psi\iR^{\pm,n}
   -\half\sigma_{t,i,R}^k\Psi\iR^{\pm,k+1}\\
  &+\half\frac{\sigma_{s,i,R}^n}{2}\phi\iR^n
   +\half\frac{\sigma_{s,i,R}^k}{2}\phi\iR^{k+1}\\
  &+\half\Q_{i,R}^{\pm,n}
   +\half\Q_{i,R}^{\pm,k} \pec
\end{split}\end{equation}

These equations can be solved by solving steady-state S$_2$ equations
of the form of Equations \requ{S2trL} and \requ{S2trR} by making
the following definitions:
\begin{equation}
  \alpha = \frac{1}{c\dt} \pec \quad \beta = \frac{1}{2}\pec
\end{equation}
%\begin{multline}
%  \tilde{Q}_{i,L}^{\pm,k} = Q_{i,L}^{\pm,n} + Q_{i,L}^{\pm,k}
%  + \sigma_{s,i,L}^n \phi_{i,L}^n - 4\pi\sigma_{t,i,L}^n \psi_{i,L}^{\pm,n}\\
%  - \frac{8\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}
%  + \frac{16\pi}{c\dt h_i}\psi_{i,L}^{\pm,n} \pec
%\end{multline}
%\begin{multline}
%  \tilde{Q}_{i,R}^{\pm,k} = Q_{i,R}^{\pm,n} + Q_{i,R}^{\pm,k}
%  + \sigma_{s,i,R}^n \phi_{i,R}^n - 4\pi\sigma_{t,i,R}^n \psi_{i,R}^{\pm,n}\\
%  - \frac{8\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_i}
%  + \frac{16\pi}{c\dt h_i}\psi_{i,R}^{\pm,n} \pep
%\end{multline}
\begin{multline}
  \tilde{\Q}_{i,L}^{\pm,k}
  = \frac{\Psi\iL^{\pm,n}}{c\dt}
  - \half\frac{2\mu^\pm}{h_i}\fn{\Psi_i^{\pm,n} - \Psi_{i-\half}^{\pm,n}}
  - \half\sigma_{t,i,L}^n\Psi\iL^{\pm,n}\\
  + \half\frac{\sigma_{s,i,L}^n}{2}\phi\iL^n
  + \half\Q\iL^{\pm,n}
  + \half\Q\iL^{\pm,k}
\end{multline}
\begin{multline}
  \tilde{\Q}_{i,R}^{\pm,k}
  = \frac{\Psi\iR^{\pm,n}}{c\dt}
  - \half\frac{2\mu^\pm}{h_i}\fn{\Psi_{i+\half}^{\pm,n} - \Psi_i^{\pm,n}}
  - \half\sigma_{t,i,R}^n\Psi\iR^{\pm,n}\\
  + \half\frac{\sigma_{s,i,R}^n}{2}\phi\iR^n
  + \half\Q\iR^{\pm,n}
  + \half\Q\iR^{\pm,k}
\end{multline}

\subsubsection{TR/BDF-2}\lsec{S2fullTRBDF2}
%-------------------------------------------------------------------------------
The fully discretized S$_2$ equations for a BDF-2 step
$t^{n}\rightarrow t^{n+1}$ are
%\begin{equation}\lequ{S2BDF2fullL}\begin{split}
%  \frac{1}{c}\frac{\psi\iL^{\pm,k+1}-\psi\iL^{\pm,n}}{\dt} = &
%   -\sixth\mu^\pm\fn{\psi^{\pm,n-1}_i - \psi^{\pm,n-1}_{i-\half}}
%   -\sixth\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}\\
%  &-\frac{2}{3}\mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}\\
%  &-\sixth\sigma_{t,i,L}^{n-1}\frac{h_i}{2}\psi\iL^{\pm,n-1}
%   -\sixth\sigma_{t,i,L}^{n}  \frac{h_i}{2}\psi\iL^{\pm,n}
%   -\frac{2}{3}\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}\\
%  &+\sixth\frac{\sigma_{s,i,L}^{n-1}}{4\pi}\frac{h_i}{2}\phi\iL^{n-1}
%   +\sixth\frac{\sigma_{s,i,L}^{n}}{4\pi}  \frac{h_i}{2}\phi\iL^{n}
%   +\frac{2}{3}\frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}\\
%  &+\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n-1}
%   +\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n}
%   +\frac{2}{3}\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
%\end{split}\end{equation}
\begin{equation}\lequ{S2BDF2fullL}\begin{split}
  \frac{1}{c}\frac{\Psi\iL^{\pm,k+1}-\Psi\iL^{\pm,n}}{\dt} = &
   -\sixth     \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n-1}_i - \Psi^{\pm,n-1}_{i-\half}}
   -\sixth     \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n}_i   - \Psi^{\pm,n}_{i-\half}}\\
  &-\frac{2}{3}\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_i - \Psi^{\pm,k+1}_{i-\half}}\\
  &-\sixth\sigma_{t,i,L}^{n-1}\Psi\iL^{\pm,n-1}
   -\sixth\sigma_{t,i,L}^{n}  \Psi\iL^{\pm,n}
   -\frac{2}{3}\sigma_{t,i,L}^k\Psi\iL^{\pm,k+1}\\
  &+\sixth\frac{\sigma_{s,i,L}^{n-1}}{2}\phi\iL^{n-1}
   +\sixth\frac{\sigma_{s,i,L}^{n}}{2}  \phi\iL^{n}
   +\frac{2}{3}\frac{\sigma_{s,i,L}^k}{2}\phi\iL^{k+1}\\
  &+\sixth\Q_{i,L}^{\pm,n-1}
   +\sixth\Q_{i,L}^{\pm,n}
   +\frac{2}{3}\Q_{i,L}^{\pm,k} \pec
\end{split}\end{equation}

%\begin{equation}\lequ{S2BDF2fullR}\begin{split}
%  \frac{1}{c}\frac{\psi\iR^{\pm,k+1}-\psi\iR^{\pm,n}}{\dt} = &
%   -\sixth\mu^\pm\fn{\psi^{\pm,n-1}_{i+\half}      - \psi^{\pm,n-1}_i}
%   -\sixth\mu^\pm\fn{\psi^{\pm,n}_{i+\half}        - \psi^{\pm,n}_i}\\
%  &-\frac{2}{3}\mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}\\
%  &-\sixth\sigma_{t,i,R}^{n-1}\frac{h_i}{2}\psi\iR^{\pm,n-1}
%   -\sixth\sigma_{t,i,R}^{n}  \frac{h_i}{2}\psi\iR^{\pm,n}
%   -\frac{2}{3}\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}\\
%  &+\sixth\frac{\sigma_{s,i,R}^{n-1}}{4\pi}\frac{h_i}{2}\phi\iR^{n-1}
%   +\sixth\frac{\sigma_{s,i,R}^{n}}{4\pi}  \frac{h_i}{2}\phi\iR^{n}
%   +\frac{2}{3}\frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}\\
%  &+\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n-1}
%   +\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n}
%   +\frac{2}{3}\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pep
%\end{split}\end{equation}
\begin{equation}\lequ{S2BDF2fullR}\begin{split}
  \frac{1}{c}\frac{\Psi\iR^{\pm,k+1}-\Psi\iR^{\pm,n}}{\dt} = &
   -\sixth     \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n-1}_{i+\half} - \Psi^{\pm,n-1}_i}
   -\sixth     \frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,n}_{i+\half}   - \Psi^{\pm,n}_i}\\
  &-\frac{2}{3}\frac{2\mu^\pm}{h_i}\fn{\Psi^{\pm,k+1}_{i+\half} - \Psi^{\pm,k+1}_i}\\
  &-\sixth\sigma_{t,i,R}^{n-1}\Psi\iR^{\pm,n-1}
   -\sixth\sigma_{t,i,R}^{n}  \Psi\iR^{\pm,n}
   -\frac{2}{3}\sigma_{t,i,R}^k\Psi\iR^{\pm,k+1}\\
  &+\sixth\frac{\sigma_{s,i,R}^{n-1}}{2}\phi\iR^{n-1}
   +\sixth\frac{\sigma_{s,i,R}^{n}}{2}  \phi\iR^{n}
   +\frac{2}{3}\frac{\sigma_{s,i,R}^k}{2}\phi\iR^{k+1}\\
  &+\sixth\Q_{i,R}^{\pm,n-1}
   +\sixth\Q_{i,R}^{\pm,n}
   +\frac{2}{3}\Q_{i,R}^{\pm,k} \pec
\end{split}\end{equation}

These equations can be solved by solving steady-state S$_2$ equations
of the form of Equations \requ{S2trL} and \requ{S2trR} by making
the following definitions:
\begin{equation}
  \alpha = \frac{1}{c\dt} \pec \quad \beta = \frac{2}{3} \pec
\end{equation}
%\begin{equation}\begin{split}
%\tilde{Q}_{i,L}^{\pm,k} = &
%    \fourth Q_{i,L}^{\pm,n-1} + \fourth Q_{i,L}^{\pm,n} + Q_{i,L}^{\pm,k}\\
%& + \fourth\sigma_{s,i,L}^{n-1}\phi_{i,L}^{n-1} + \fourth\sigma_{s,i,L}^n\phi_{i,L}^n \\
%& - \pi\sigma_{t,i,L}^{n-1}\psi_{i,L}^{\pm,n-1} - \pi\sigma_{t,i,L}^{n}\psi_{i,L}^{\pm,n} \\
%& - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n-1}_i - \psi^{\pm,n-1}_{i-\half}}
%  - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}} \\
%& + \frac{4\pi}{c\dt h_i}\psi_{i,L}^{\pm,n-1} + \frac{4\pi}{c\dt h_i}\psi_{i,L}^{\pm,n} \pec
%\end{split}\end{equation}
%\begin{equation}\begin{split}
%\tilde{Q}_{i,R}^{\pm,k} = &
%    \fourth Q_{i,R}^{\pm,n-1} + \fourth Q_{i,R}^{\pm,n} + Q_{i,R}^{\pm,k}\\
%& + \fourth\sigma_{s,i,R}^{n-1}\phi_{i,R}^{n-1} + \fourth\sigma_{s,i,R}^n\phi_{i,R}^n \\
%& - \pi\sigma_{t,i,R}^{n-1}\psi_{i,R}^{\pm,n-1} - \pi\sigma_{t,i,R}^{n}\psi_{i,R}^{\pm,n} \\
%& - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n-1}_{i+\half} - \psi^{\pm,n-1}_{i}}
%  - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_{i}} \\
%& + \frac{4\pi}{c\dt h_i}\psi_{i,R}^{\pm,n-1} + \frac{4\pi}{c\dt h_i}\psi_{i,R}^{\pm,n} \pep
%\end{split}\end{equation}
\begin{multline}
  \tilde{\Q}_{i,L}^{\pm,k}
  = \frac{\Psi\iL^{\pm,n}}{c\dt}
  - \sixth\frac{2\mu^\pm}{h_i}\fn{\Psi_i^{\pm,n-1} - \Psi_{i-\half}^{\pm,n-1}}
  - \sixth\frac{2\mu^\pm}{h_i}\fn{\Psi_i^{\pm,n} - \Psi_{i-\half}^{\pm,n}}\\
  - \sixth\sigma_{t,i,L}^{n-1}\Psi\iL^{\pm,n-1}
  - \sixth\sigma_{t,i,L}^n    \Psi\iL^{\pm,n}
  + \sixth\frac{\sigma_{s,i,L}^{n-1}}{2}\phi\iL^{n-1}
  + \sixth\frac{\sigma_{s,i,L}^n}{2}    \phi\iL^n\\
  + \sixth\Q\iL^{\pm,n-1}
  + \sixth\Q\iL^{\pm,n}
  + \frac{2}{3}\Q\iL^{\pm,k}
\end{multline}
\begin{multline}
  \tilde{\Q}_{i,R}^{\pm,k}
  = \frac{\Psi\iR^{\pm,n}}{c\dt}
  - \sixth\frac{2\mu^\pm}{h_i}\fn{\Psi_{i+\half}^{\pm,n-1} - \Psi_i^{\pm,n-1}}
  - \sixth\frac{2\mu^\pm}{h_i}\fn{\Psi_{i+\half}^{\pm,n}   - \Psi_i^{\pm,n}}\\
  - \sixth\sigma_{t,i,R}^{n-1}\Psi\iR^{\pm,n-1}
  - \sixth\sigma_{t,i,R}^n    \Psi\iR^{\pm,n}
  + \sixth\frac{\sigma_{s,i,R}^{n-1}}{2}\phi\iR^{n-1}
  + \sixth\frac{\sigma_{s,i,R}^n}{2}    \phi\iR^n\\
  + \sixth\Q\iR^{\pm,n-1}
  + \sixth\Q\iR^{\pm,n}
  + \frac{2}{3}\Q\iR^{\pm,k}
\end{multline}

%===============================================================================
\section{Implementation}
%===============================================================================
\subsection{Pseudocode}
%-------------------------------------------------------------------------------
Let $\H$ denote the hydrodynamic unknowns, i.e., $(\rho_i,u_i,E_i)\,\forall i$,
let $\R$ denote the radiation unknowns, i.e., $(\Psi_{i,L}^\pm,\Psi_{i,R}^\pm)
\,\forall i$, and let $\U$ denote both hydrodynamic and radiation
unknowns. The pseudocode is listed below:

\begin{lstlisting}[mathescape,columns=fullflexible,
   basicstyle=\fontfamily{lmvtt}\selectfont]
processInput()
$\U^0 =$ computeInitialConditions()
for each time step $n$

   $\dt =$ computeTimeStepSize($\U^n$)

   $\H^* =$ MUSCLHancockEvolve($\H^n,\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^n,\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^n,\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^n,\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\fourth} = \U^{k+1}$

   $\H^* =$ MUSCLHancockRiemann($\H^n,\H^{n+\fourth},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^{n+\fourth},\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^{n+\fourth},\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^{n+\fourth},\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\half} = \U^{k+1}$

   $\H^* =$ MUSCLHancockEvolve($\H^{n+\half},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^{n+\half},\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^{n+\half},\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^{n+\half},\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\frac{3}{4}} = \U^{k+1}$

   $\H^* =$ MUSCLHancockRiemann($\H^{n+\half},\H^{n+\frac{3}{4}},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateTRBDF2($\U^n,\U^{n+\half},\H^*,\U^k,\half\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateTRBDF2($\U^n,\U^{n+\half},\H^*,\U^k,\half\dt$)
      $\R^{k+1} =$ radiationSolveTRBDF2($\U^n,\U^{n+\half},\U^k,\half\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+1} = \U^{k+1}$

end time step loop
postProcess()
\end{lstlisting}

The radiation solves employ a steady-state S$_2$ solver, as discussed
in Section \rsec{S2ssdisc}, where the specific definitions for
CN and TR/BDF-2 are given in Sections \rsec{S2fullCN} and \rsec{S2fullTRBDF2},
respectively. Below are pseudocodes for the wrapper functions
\texttt{radiationSolveCN()} and \texttt{radiationSolveTRBDF2()}:

\begin{lstlisting}[mathescape,columns=fullflexible,
   basicstyle=\fontfamily{lmvtt}\selectfont]
$\R^{k+1} =$ radiationSolveCN($\U^n,\U^k,\dt$)
{
   $\tilde{\Q}^{\pm,k} =$ computeCNSource($\U^n,\U^k,\dt$)
   $\R^{k+1} =$ radiationSolveSS($\sigma^k,\tilde{\Q}^{\pm,k},\alpha^{CN}
     ,\beta^{CN}$)
}

$\R^{k+1} =$ radiationSolveTRBDF2($\U^{n-1},\U^n,\U^k,\dt$)
{
   $\tilde{\Q}^{\pm,k} =$ computeTRBDF2Source($\U^{n-1},\U^n,\U^k,\dt$)
   $\R^{k+1} =$ radiationSolveSS($\sigma^k,\tilde{\Q}^{\pm,k},\alpha^{TR/BDF-2}
     ,\beta^{TR/BDF-2}$)
}
\end{lstlisting}

%===============================================================================
\section{Test Problems}
%===============================================================================
\subsection{Steady-State Diffusion Test Problem}
%-------------------------------------------------------------------------------
The following parameters were used:
\[
   x\in(0,3),
   \quad \sigma_a = 0.25,
   \quad \sigma_s = 0.75,
   \quad j^+(0) = j^-(3) = 0,
   \quad Q = 1
\]
The exact solution to this problem is the following:
\[
   \phi(x) = A\sinh\fn{\frac{x}{L}} + B\cosh\fn{\frac{x}{L}} + Q\frac{L^2}{D} \pec
\]
where $D=\frac{1}{3\sigma_t}$, $L=\sqrt{\frac{D}{\sigma_a}}$, and $A$ and $B$ are
complicated expressions that come out to the following values:
\[
   A=2.4084787907,\quad B=-2.7957606046 \pep
\]

\subsection{Steady-State Pure Absorber Test Problem}
%-------------------------------------------------------------------------------
The following parameters were used:
\begin{gather*}
   x\in(x_L,x_R)=(0,10),
   \quad \sigma_a = 0.1,
   \quad \sigma_s = 0,\\
   \psi^+(x_L) = 20,
   \quad \psi^-(x_R) = 30,
   \quad Q^\pm = 0
\end{gather*}
The exact solution to this problem is the following:
\[
   \psi^-(x) = \psi^-(x_R)e^{-\frac{\sigma_a}{\mu^-}\fn{x-x_R}} \pec
\]
\[
   \psi^+(x) = \psi^+(x_L)e^{-\frac{\sigma_a}{\mu^-}\fn{x-x_L}} \pep
\]

\end{document}
