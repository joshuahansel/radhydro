\documentclass[preprint,12pt]{elsarticle}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{color}
\usepackage{listings}
\usepackage[colorlinks]{hyperref}
\input{newcommands}
\newcommand{\sigsL}{\frac{\sigma_{s,i,L}^k}{2}}
\newcommand{\sigsR}{\frac{\sigma_{s,i,R}^k}{2}}
\newcommand{\sigtL}{\sigma_{t,i,L}^k}
\newcommand{\sigtR}{\sigma_{t,i,R}^k}
\newcommand{\halfh}{\frac{h_i}{2}}

\begin{document}
\tableofcontents
\newpage

%===============================================================================
\section{Introduction}
%===============================================================================

In this work, a new IMEX scheme for solving the equations of radiation
hydrodynamics (RH) that is second-order accurate in both space and time is
presented and tested. A RH system combining a 1-D slab model
of compressible fluid dynamics with a grey radiation S$_2$ model is considered,
given by:
\begin{subequations}
\lequ{radhydro_system}
\be
\dxdy{\rho}{t}+\dxdy{}{x}\fn{\rho u} = 0 \pec
\lequ{cons_mass}
\ee 
\be
\dxdy{}{t}\fn{\rho u} + \dxdy{}{x}\fn{\rho u^2} + \dxdy{}{x}\fn{p}
  = \frac{\sigma_t}{c} \F_0 \pec
\lequ{cons_mom}
\ee
\be
\dxdy{E}{t} + \dxdy{}{x}\bracket{\fn{E+p}u}=-\sigma_a c \fn{aT^4 - \E}
  + \frac{\sigma_t u}{c} \F_0 \pec
\lequ{cons_energy}
\ee
\be
\frac{1}{c}\dxdy{\psi^+}{t} + \frac{1}{\sqrt{3}}\dxdy{\psi^+}{x}
  + \sigma_t \psi^+ = \frac{\sigma_s}{4\pi} c\E + \frac{\sigma_a}{4\pi} acT^4
  - \frac{\sigma_t u}{4\pi c} \F_0 + \frac{\sigma_t}{\sqrt{3}\pi}\E u
\pec
\lequ{intp}
\ee
\be
\frac{1}{c}\dxdy{\psi^-}{t} - \frac{1}{\sqrt{3}}\dxdy{\psi^-}{x}
  + \sigma_t \psi^- = \frac{\sigma_s}{4\pi} c\E + \frac{\sigma_a}{4\pi} acT^4
  - \frac{\sigma_t u}{4\pi c} \F_0 - \frac{\sigma_t}{\sqrt{3}\pi}\E u
\pec
\lequ{intm}
\ee
\end{subequations}
where $\rho$ is the density, $u$ is the velocity,
$E=\rho\fn{\frac{u^2}{2} + e}$ is the total material energy density,
$e$ is the specific internal energy density, $T$ is the material temperature,
$\E$ is the radiation energy density:
\be
\E = \frac{2\pi}{c}\fn{\psi^{+}+\psi^{-}} \pec
\lequ{Erad}
\ee
$\F$ is the radiation energy flux:
\be
\F = \frac{2\pi}{\sqrt{3}}\fn{\psi^{+}-\psi^{-}} \pec
\lequ{flux}
\ee
and $\F_0$ is an approximation to the comoving-frame flux,
\be
\lequ{F_nu_0}
\F_0 = \F-\frac{4}{3} \E u \pep
\ee
Note that multiplying Eqs.~\requ{intp} and \requ{intm} by $2\pi$ and summing
them gives the radiation energy equation:
\begin{subequations}
\be
\dxdy{\E}{t} + \dxdy{\F}{x} = \sigma_a c(aT^4 - \E) - \frac{\sigma_t u}{c}\F_0 \pec
\lequ{erad}
\ee
and multiplying \equ{intp} by $\frac{2\pi}{c\sqrt{3}}$ and \equ{intm} by
$-\frac{2\pi}{c\sqrt{3}}$ and sum them, we get the radiation momentum equation: 
\be
\frac{1}{c^2}\dxdy{\F}{t} + \frac{1}{3}\dxdy{\E}{x} = -\frac{\sigma_t}{c}\F_0 \pep
\ee
\end{subequations}
Equations \requ{cons_mass} through \requ{intm} are closed by assuming an ideal
equation of state (EOS):
\begin{subequations}
\be
p=\rho e (\gamma -1)
\lequ{pressure}
\pec
\ee
\be
T = \frac{e}{c_v} \pec
\lequ{matemp}
\ee
\end{subequations}
where $\gamma$ is the adiabatic index, and $c_v$ is the specific heat capacity.
However, the method presented is compatible with any valid EOS. 

%===============================================================================
\subsection{Source Definitions for the \texorpdfstring{S$_2$}{S-2} Equations}
%===============================================================================

Taking the zeroth angular moment of the S$_2$ equations, given by Equations
\requ{intp} and \requ{intm}, gives
\be
\frac{1}{c}\dydt{\phi} + \dydx{\F} + \sigma_t\phi = \sigma_s\phi + Q_0 \pec
\lequ{zerothmoment}
\ee
where $\phi = c\E$ and the source $Q_0$ is
\be
Q_0 = \sigma_a acT^4 - \sigma_t\frac{u}{c}\F_0 \pep
\lequ{Q0}
\ee
Taking the first angular moment of the S$_2$ equations gives
\be
\frac{1}{c}\dydt{\F} + \dydx{\phi} + \sigma_t\F = Q_1 \pec
\lequ{firstmoment}
\ee
where $Q_1$ is
\be
Q_1 = \frac{4}{3}\sigma_t\E u \pep
\lequ{Q1}
\ee
Defining a total source as
\be
Q^\pm = Q_0 + 3\mu^\pm Q_1
\lequ{Qdef}
\ee
and rewriting the S$_2$ equations gives
\be
\frac{1}{c}\dydt{\psi^\pm} + \mu^\pm\dydx{\psi^\pm} + \sigma_t\psi^\pm
  = \frac{\sigma_s}{4\pi}\phi + \frac{1}{4\pi}Q^\pm \pec
\lequ{S2Q}
\ee
where $\mu^\pm=\pm\frac{1}{\sqrt{3}}$.

%===============================================================================
\section{Solution Overview}
%===============================================================================
The solution for a time step $t\rightarrow t+\dt$ consists of four nonlinear
solves:

\begin{enumerate}
  \item CN from $n$ to $n+\fourth$
  \item CN from $n+\fourth$ to $n+\half$
  \item CN from $n+\half$ to $n+\frac{3}{4}$
  \item TR/BDF-2 from $n+\half$ to $n+1$
\end{enumerate}

%===============================================================================
\section{MUSCL-Hancock Algorithm}
%===============================================================================

The homogeneous Euler equations may be expressed in conservative form as
\be
\dydt{\U} + \nabla\cdot\Flux(\U) = \mathbf{0}\quad
\U=\left[\begin{array}{c}\rho\\\rho u\\E\end{array}\right]\quad
\Flux(\U)=\left[\begin{array}{c}\rho u\\
  \rho u^2 + p\\
  (E+p)u\end{array}\right] \pec
\ee
where $\U$ is a vector of the conservative unknowns
and $\Flux(\U)$ is the flux associated with each:
\be
\U=\left[\begin{array}{c}\rho\\\rho u\\E\end{array}\right] \pec\qquad
\Flux(\U)=\left[\begin{array}{c}\rho u\\
  \rho u^2 + p\\
  (E+p)u\end{array}\right] \pep
\ee
The first half of a MUSCL-Hancock step $t^n\rightarrow t^n+\dt$
consists of constructing a linear representation of the solution:
\be
  \U\iL^n = \U_i^n - \frac{\Delta_i^n}{2} \pec
  \quad
  \U\iR^n = \U_i^n + \frac{\Delta_i^n}{2} \pec
\ee
and then evolving that representation by half a time step:
\be
  \U_i^{n+\half} = \U_i^n - \frac{\half\dt}{\dx}
  \left(\Flux(\U\iR^n) - \Flux(\U\iL^n)\right) \pep
\ee
The second half of a MUSCL-Hancock step employs a Riemann solver
to compute the fluxes at time $n+\half$:
\be
  \U_i^{n+1} = \U_i^n - \frac{\dt}{\dx}
  \left(\Flux_{i+\half}^{n+\half} - \Flux_{i-\half}^{n+\half}\right)
\ee

%===============================================================================
\section{Spatial Discretization}
%===============================================================================

A lumped linear discontinuous (LLD) spatial discretization is employed
for the S$_2$ equations, so the angular flux
unknowns are the left and right values $\psi_{i,L}^\pm$ and
$\psi_{i,R}^\pm$ for each cell $i$. The spatially
discretized equations result from integrating each half cell
$(x_i-\frac{h_i}{2},x_i)$ and $(x_i,x_i+\frac{h_i}{2})$,
where $x_i$ is the cell center, and $h_i$ is the cell width.
The fully discretized equations are given in Section \rsec{full}.

%===============================================================================
\subsection{Steady-State \texorpdfstring{S$_2$}{S-2} Equations}\lsec{S2ssdisc}
%===============================================================================
Using an LLD discretization, the steady-state
S$_2$ equations (obtained by dropping the $\dydt{\psi^\pm}$ in Equation
\requ{S2Q}) become
\begin{equation}
  \mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}
  +\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}=
  \frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}
  +\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
\lequ{S2ssL}
\end{equation}
\begin{equation}
  \mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}
  +\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}=
  \frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}
  +\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pec
\lequ{S2ssR}
\end{equation}
where the cell center and edge fluxes are defined as
\begin{equation}
  \psi_i^\pm=\half\fn{\psi_{i,L}^\pm + \psi_{i,R}^\pm} \pec
\end{equation}
\begin{equation}
  \psi_{i+\half}^+=\psi_{i,R}^+ \pec\qquad \psi_{i+\half}^-=\psi_{i+1,L}^- \pep
\end{equation}
Coefficients of the resulting linear system matrix are the following,
where conditions in parentheses indicate when a term does not
apply for the boundary elements $i=1$ and $i=N$:
\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i-1,R,+$ & $i,L,-$ & $i,L,+$\\\hline\hline
  $i,L,-$ &
          & $-\half\mu^- + \sigtL\halfh - \sigsL\halfh$
          & $-\sigsL\halfh$ \\\hline
  $i,L,+$ & $-\mu^+$ ($i\ne 1$)
          & $-\sigsL\halfh$
          & $\half\mu^+ + \sigtL\halfh - \sigsL\halfh$ \\\hline
  $i,R,-$ &
          & $-\half\mu^-$
          & \\\hline
  $i,R,+$ &
          &
          & $-\half\mu^+$ \\\hline
\end{tabular}
\end{center}
\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i,R,-$ & $i,R,+$ & $i+1,L,-$\\\hline\hline
  $i,L,-$ & $\half\mu^-$
          &
          & \\\hline
  $i,L,+$ &
          & $\half\mu^+$
          & \\\hline
  $i,R,-$ & $-\half\mu^- + \sigtR\halfh - \sigsR\halfh$
          & $-\sigsR\halfh$
          & $\mu^-$ ($i\ne N$) \\\hline
  $i,R,+$ & $-\sigsR\halfh$
          & $\half\mu^+ + \sigtR\halfh - \sigsR\halfh$
          & \\\hline
\end{tabular}
\end{center}
The right hand side vector for the linear system is the following,
where the columns indicate to which cell(s) the expressions
correspond:

\begin{center}
\begin{tabular}{|l||c|c|c|}\hline
          & $i=1$ & $i=2\ldots N-1$ & $i=N$\\\hline\hline
  $i,L,-$ & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,L}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,L}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,L}$ \\\hline
  $i,L,+$ & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,L} + \mu^+\psi^+_{inc}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,L}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,L}$ \\\hline
  $i,R,-$ & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,R}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,R}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^-_{i,R} - \mu^-\psi^-_{inc}$ \\\hline
  $i,R,+$ & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,R}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,R}$
          & $\frac{1}{4\pi}\frac{h_i}{2}Q^+_{i,R}$ \\\hline
\end{tabular}
\end{center}

Transient S$_2$ solvers can employ a steady-state solver if
the following generalization is made to Equations \requ{S2ssL}
and \requ{S2ssR}:
\begin{equation}
  \mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}
  +\fn{\sigma_{t,i,L}^k + \alpha}\frac{h_i}{2}\psi\iL^{\pm,k+1}=
  \frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}
  +\frac{1}{4\pi}\frac{h_i}{2}\tilde{Q}_{i,L}^{\pm,k} \pec
\lequ{S2trL}
\end{equation}
\begin{equation}
  \mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}
  +\fn{\sigma_{t,i,R}^k + \alpha}\frac{h_i}{2}\psi\iR^{\pm,k+1}=
  \frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}
  +\frac{1}{4\pi}\frac{h_i}{2}\tilde{Q}_{i,R}^{\pm,k} \pec
\lequ{S2trR}
\end{equation}
where $\alpha$ and $\tilde{Q}^\pm$ depend on the time discretization used.

%===============================================================================
\section{Temporal Discretization}
%===============================================================================
\subsection{Fluid Momentum Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}
  \frac{\rho^{n+1}\left(u^{k+1}-u^*\right)}{\dt} = 
   \half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
  +\half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{\rho^{n+1}\left(u^{k+1}-u^*\right)}{\half\dt} =  
  & \sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
   +\sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{n+\half}\\
  &+\frac{2}{3}\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{k+1}
  \pep
\end{split}\end{equation}

\subsection{Fluid Energy Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E^{k+1}-E^*}{\dt} = &
  -\half\left[\sigma_{a} c\left(aT^4 - \E\right)\right]^n
  -\half\sigma_{a}^k c\left[aT^4 - \E\right]^{k+1}\\
  &+\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n
   +\half\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{split}\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E^{k+1}-E^*}{\half\dt} = &
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]^n
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]^{n+\half}\\
  &-\frac{2}{3}\sigma_a^k c\left[aT^4 - \E\right]^{k+1}
   +\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^n\\
  &+\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^{n+\half}
   +\frac{2}{3}\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]^k
  \pep
\end{split}\end{equation}


\subsection{\texorpdfstring{S$_2$}{S-2} Equations}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
Applying the Crank-Nicolson scheme to Equation \requ{S2Q} for a step
$t^n\rightarrow t^{n+1}$, the S-2 equations become
\be\begin{split}
\frac{1}{c}\frac{\psi^{\pm,k+1}-\psi^{\pm,n}}{\dt} = &
  -\half\mu^\pm\dydx{\psi^{\pm,n}} -\half\mu^\pm\dydx{\psi^{\pm,k+1}}\\
  &-\half\sigma_t^n\psi^{\pm,n} -\half\sigma_t^k\psi^{\pm,k+1}\\
  &+\half\frac{\sigma_s^n}{4\pi}\phi^n +\half\frac{\sigma_s^k}{4\pi}\phi^{k+1}\\
  &+\half\frac{1}{4\pi}Q^{\pm,n} +\half\frac{1}{4\pi}Q^{\pm,k} \pec
\lequ{S2CN}
\end{split}\ee
where $k$ represents the $k$th iteration of a quantity at time $t^{n+1}$.

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
Applying the BDF-2 scheme to Equation \requ{S2Q} for a step
$t^{n}\rightarrow t^{n+1}$, the S-2 equations become
\be\begin{split}
\frac{1}{c}\frac{\psi^{\pm,k+1}-\psi^{\pm,n}}{\dt} = &
  -\sixth\mu^\pm\dydx{\psi^{\pm,n-1}}
  -\sixth\mu^\pm\dydx{\psi^{\pm,n}}
  -\frac{2}{3}\mu^\pm\dydx{\psi^{\pm,k+1}}\\
  &-\sixth\sigma_t^{n-1}\psi^{\pm,n-1}
   -\sixth\sigma_t^{n}  \psi^{\pm,n}
   -\frac{2}{3}\sigma_t^k\psi^{\pm,k+1}\\
  &+\sixth\frac{\sigma_s^{n-1}}{4\pi}\phi^{n-1}
   +\sixth\frac{\sigma_s^{n}}{4\pi}  \phi^{n}
   +\frac{2}{3}\frac{\sigma_s^k}{4\pi}\phi^{k+1}\\
  &+\sixth\frac{1}{4\pi}Q^{\pm,n-1}
   +\sixth\frac{1}{4\pi}Q^{\pm,n}
   +\frac{2}{3}\frac{1}{4\pi}Q^{\pm,k} \pec
\lequ{S2BDF2}
\end{split}\ee
where $k$ represents the $k$th iteration of a quantity at time $t^{n+1}$.

%===============================================================================
\section{Fully Discretized Equations}\lsec{full}
%===============================================================================
\subsection{Fluid Momentum Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}
  \frac{\rho_i^{n+1}\left(u_i^{k+1}-u_i^*\right)}{\dt} = 
   \half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
  +\half\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydromCNfull}
\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{\rho_i^{n+1}\left(u_i^{k+1}-u_i^*\right)}{\half\dt} =  
  & \sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
   +\sixth\left[\frac{\sigma_{t}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{n+\half}\\
  &+\frac{2}{3}\left[\frac{\sigma_{t,i}}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{k+1}
  \pep
\lequ{hydromBDF2full}
\end{split}\end{equation}

%-------------------------------------------------------------------------------
\subsection{Fluid Energy Source Update Equation}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}
%-------------------------------------------------------------------------------
For a step $t^n\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E_i^{k+1}-E_i^*}{\dt} = &
  -\half\left[\sigma_{a} c\left(aT_i^4 - \E_i\right)\right]_i^n
  -\half\left[\sigma_{a}^k c\left(a(T^{k+1})^4 - \E^{k+1}\right)\right]_i\\
  &+\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n
   +\half\left[\sigma_{t}\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydroECNfull}
\end{split}\end{equation}

\subsubsection{TR/BDF-2}
%-------------------------------------------------------------------------------
For a step $t^{n+\half}\rightarrow t^{n+1}$,
\begin{equation}\begin{split}
  \frac{E_i^{k+1}-E_i^*}{\half\dt} = &
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]_i^n
  -\sixth\left[\sigma_a c\left(aT^4 - \E\right)\right]_i^{n+\half}\\
  &-\frac{2}{3}\left[\sigma_a^k c\left(a(T^{k+1})^4 - \E^{k+1}\right)\right]_i
   +\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^n\\
  &+\sixth\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^{n+\half}
   +\frac{2}{3}\left[\sigma_t\frac{u}{c}\left(\F-\frac{4}{3}\E u\right)\right]_i^k
  \pep
\lequ{hydroEBDF2full}
\end{split}\end{equation}

%-------------------------------------------------------------------------------
\subsection{\texorpdfstring{S$_2$}{S-2} Equations}
%-------------------------------------------------------------------------------
\subsubsection{Crank-Nicolson}\lsec{S2fullCN}
%-------------------------------------------------------------------------------
The fully discretized S$_2$ equations for a Crank-Nicolson step
$t^n\rightarrow t^{n+1}$ are
\begin{equation}\begin{split}
\frac{1}{c}\frac{\psi\iL^{\pm,k+1}-\psi\iL^{\pm,n}}{\dt} = &
  -\half\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}
  -\half\mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}\\
  &-\half\sigma_{t,i,L}^n\frac{h_i}{2}\psi\iL^{\pm,n}
   -\half\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}\\
  &+\half\frac{\sigma_{s,i,L}^n}{4\pi}\frac{h_i}{2}\phi\iL^n
   +\half\frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}\\
  &+\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n}
   +\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
\lequ{S2CNfullL}
\end{split}\end{equation}

\begin{equation}\begin{split}
\frac{1}{c}\frac{\psi\iR^{\pm,k+1}-\psi\iR^{\pm,n}}{\dt} = &
  -\half\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_i}
  -\half\mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}\\
  &-\half\sigma_{t,i,R}^n\frac{h_i}{2}\psi\iR^{\pm,n}
   -\half\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}\\
  &+\half\frac{\sigma_{s,i,R}^n}{4\pi}\frac{h_i}{2}\phi\iR^n
   +\half\frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}\\
  &+\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n}
   +\half\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pep
\lequ{S2CNfullR}
\end{split}\end{equation}

These equations can be solved by solving steady-state S$_2$ equations
of the form of Equations \requ{S2trL} and \requ{S2trR} by making
the following definitions:
\begin{equation}
\alpha = \frac{2}{c\dt} \pec
\end{equation}
\begin{multline}
\tilde{Q}_{i,L}^{\pm,k} = Q_{i,L}^{\pm,n} + Q_{i,L}^{\pm,k}
  + \sigma_{s,i,L}^n \phi_{i,L}^n - 4\pi\sigma_{t,i,L}^n \psi_{i,L}^{\pm,n}\\
  - \frac{8\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}
  + \frac{16\pi}{c\dt h_i}\psi_{i,L}^{\pm,n} \pec
\end{multline}
\begin{multline}
\tilde{Q}_{i,R}^{\pm,k} = Q_{i,R}^{\pm,n} + Q_{i,R}^{\pm,k}
  + \sigma_{s,i,R}^n \phi_{i,R}^n - 4\pi\sigma_{t,i,R}^n \psi_{i,R}^{\pm,n}\\
  - \frac{8\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_i}
  + \frac{16\pi}{c\dt h_i}\psi_{i,R}^{\pm,n} \pep
\end{multline}

\subsubsection{TR/BDF-2}\lsec{S2fullTRBDF2}
%-------------------------------------------------------------------------------
The fully discretized S$_2$ equations for a BDF-2 step
$t^{n}\rightarrow t^{n+1}$ are
\begin{equation}\begin{split}
\frac{1}{c}\frac{\psi\iL^{\pm,k+1}-\psi\iL^{\pm,n}}{\dt} = &
   -\sixth\mu^\pm\fn{\psi^{\pm,n-1}_i - \psi^{\pm,n-1}_{i-\half}}
   -\sixth\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}}\\
  &-\frac{2}{3}\mu^\pm\fn{\psi^{\pm,k+1}_i - \psi^{\pm,k+1}_{i-\half}}\\
  &-\sixth\sigma_{t,i,L}^{n-1}\frac{h_i}{2}\psi\iL^{\pm,n-1}
   -\sixth\sigma_{t,i,L}^{n}  \frac{h_i}{2}\psi\iL^{\pm,n}
   -\frac{2}{3}\sigma_{t,i,L}^k\frac{h_i}{2}\psi\iL^{\pm,k+1}\\
  &+\sixth\frac{\sigma_{s,i,L}^{n-1}}{4\pi}\frac{h_i}{2}\phi\iL^{n-1}
   +\sixth\frac{\sigma_{s,i,L}^{n}}{4\pi}  \frac{h_i}{2}\phi\iL^{n}
   +\frac{2}{3}\frac{\sigma_{s,i,L}^k}{4\pi}\frac{h_i}{2}\phi\iL^{k+1}\\
  &+\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n-1}
   +\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,n}
   +\frac{2}{3}\frac{1}{4\pi}\frac{h_i}{2}Q_{i,L}^{\pm,k} \pec
\lequ{S2BDF2fullL}
\end{split}\end{equation}

\begin{equation}\begin{split}
\frac{1}{c}\frac{\psi\iR^{\pm,k+1}-\psi\iR^{\pm,n}}{\dt} = &
   -\sixth\mu^\pm\fn{\psi^{\pm,n-1}_{i+\half}      - \psi^{\pm,n-1}_i}
   -\sixth\mu^\pm\fn{\psi^{\pm,n}_{i+\half}        - \psi^{\pm,n}_i}\\
  &-\frac{2}{3}\mu^\pm\fn{\psi^{\pm,k+1}_{i+\half} - \psi^{\pm,k+1}_i}\\
  &-\sixth\sigma_{t,i,R}^{n-1}\frac{h_i}{2}\psi\iR^{\pm,n-1}
   -\sixth\sigma_{t,i,R}^{n}  \frac{h_i}{2}\psi\iR^{\pm,n}
   -\frac{2}{3}\sigma_{t,i,R}^k\frac{h_i}{2}\psi\iR^{\pm,k+1}\\
  &+\sixth\frac{\sigma_{s,i,R}^{n-1}}{4\pi}\frac{h_i}{2}\phi\iR^{n-1}
   +\sixth\frac{\sigma_{s,i,R}^{n}}{4\pi}  \frac{h_i}{2}\phi\iR^{n}
   +\frac{2}{3}\frac{\sigma_{s,i,R}^k}{4\pi}\frac{h_i}{2}\phi\iR^{k+1}\\
  &+\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n-1}
   +\sixth\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,n}
   +\frac{2}{3}\frac{1}{4\pi}\frac{h_i}{2}Q_{i,R}^{\pm,k} \pep
\lequ{S2BDF2fullR}
\end{split}\end{equation}

These equations can be solved by solving steady-state S$_2$ equations
of the form of Equations \requ{S2trL} and \requ{S2trR} by making
the following definitions:
\begin{equation}
\alpha = \frac{3}{2c\dt} \pec
\end{equation}
\begin{equation}\begin{split}
\tilde{Q}_{i,L}^{\pm,k} = &
    \fourth Q_{i,L}^{\pm,n-1} + \fourth Q_{i,L}^{\pm,n} + Q_{i,L}^{\pm,k}\\
& + \fourth\sigma_{s,i,L}^{n-1}\phi_{i,L}^{n-1} + \fourth\sigma_{s,i,L}^n\phi_{i,L}^n \\
& - \pi\sigma_{t,i,L}^{n-1}\psi_{i,L}^{\pm,n-1} - \pi\sigma_{t,i,L}^{n}\psi_{i,L}^{\pm,n} \\
& - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n-1}_i - \psi^{\pm,n-1}_{i-\half}}
  - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_i - \psi^{\pm,n}_{i-\half}} \\
& + \frac{4\pi}{c\dt h_i}\psi_{i,L}^{\pm,n-1} + \frac{4\pi}{c\dt h_i}\psi_{i,L}^{\pm,n} \pec
\end{split}\end{equation}
\begin{equation}\begin{split}
\tilde{Q}_{i,R}^{\pm,k} = &
    \fourth Q_{i,R}^{\pm,n-1} + \fourth Q_{i,R}^{\pm,n} + Q_{i,R}^{\pm,k}\\
& + \fourth\sigma_{s,i,R}^{n-1}\phi_{i,R}^{n-1} + \fourth\sigma_{s,i,R}^n\phi_{i,R}^n \\
& - \pi\sigma_{t,i,R}^{n-1}\psi_{i,R}^{\pm,n-1} - \pi\sigma_{t,i,R}^{n}\psi_{i,R}^{\pm,n} \\
& - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n-1}_{i+\half} - \psi^{\pm,n-1}_{i}}
  - \frac{2\pi}{h_i}\mu^\pm\fn{\psi^{\pm,n}_{i+\half} - \psi^{\pm,n}_{i}} \\
& + \frac{4\pi}{c\dt h_i}\psi_{i,R}^{\pm,n-1} + \frac{4\pi}{c\dt h_i}\psi_{i,R}^{\pm,n} \pep
\end{split}\end{equation}

%===============================================================================
\section{Implementation}
%===============================================================================
\subsection{Pseudocode}
%-------------------------------------------------------------------------------
Let $\H$ denote the hydrodynamic unknowns, i.e., $(\rho_i,u_i,E_i)\,\forall i$,
let $\R$ denote the radiation unknowns, i.e., $(\psi_{i,L}^\pm,\psi_{i,R}^\pm)
\,\forall i$, and let $\U$ denote both hydrodynamic and radiation
unknowns. The pseudocode is listed below:

\begin{lstlisting}[mathescape,columns=fullflexible,
   basicstyle=\fontfamily{lmvtt}\selectfont]
processInput()
$\U^0 =$ computeInitialConditions()
for each time step $n$

   $\dt =$ computeTimeStepSize($\U^n$)

   $\H^* =$ MUSCLHancockEvolve($\H^n,\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^n,\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^n,\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^n,\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\fourth} = \U^{k+1}$

   $\H^* =$ MUSCLHancockRiemann($\H^n,\H^{n+\fourth},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^{n+\fourth},\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^{n+\fourth},\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^{n+\fourth},\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\half} = \U^{k+1}$

   $\H^* =$ MUSCLHancockEvolve($\H^{n+\half},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateCN($\U^{n+\half},\H^*,\U^k,\fourth\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateCN($\U^{n+\half},\H^*,\U^k,\fourth\dt$)
      $\R^{k+1} =$ radiationSolveCN($\U^{n+\half},\U^k,\fourth\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+\frac{3}{4}} = \U^{k+1}$

   $\H^* =$ MUSCLHancockRiemann($\H^{n+\half},\H^{n+\frac{3}{4}},\half\dt$)
   for each iteration $k$
      $u^{k+1} =$ hydroMomentumSourceUpdateTRBDF2($\U^n,\U^{n+\half},\H^*,\U^k,\half\dt$)
      $E^{k+1} =$ hydroEnergySourceUpdateTRBDF2($\U^n,\U^{n+\half},\H^*,\U^k,\half\dt$)
      $\R^{k+1} =$ radiationSolveTRBDF2($\U^n,\U^{n+\half},\U^k,\half\dt$)
      converged = checkConvergence($\U^k,\U^{k+1}$)
      if converged, then exit
   end iteration loop
   $\U^{n+1} = \U^{k+1}$

end time step loop
postProcess()
\end{lstlisting}

The radiation solves employ a steady-state S$_2$ solver, as discussed
in Section \rsec{S2ssdisc}, where the specific definitions for
CN and TR/BDF-2 are given in Sections \rsec{S2fullCN} and \rsec{S2fullTRBDF2},
respectively. Below are pseudocodes for the wrapper functions
\texttt{radiationSolveCN()} and \texttt{radiationSolveTRBDF2()}:

\begin{lstlisting}[mathescape,columns=fullflexible,
   basicstyle=\fontfamily{lmvtt}\selectfont]
$\R^{k+1} =$ radiationSolveCN($\U^n,\U^k,\dt$)
{
   $\tilde{Q}^{\pm,k} =$ computeCNSource($\U^n,\U^k,\dt$)
   $\R^{k+1} =$ radiationSolveSS($\sigma^k,\tilde{Q}^{\pm,k},\alpha^{CN}$)
}

$\R^{k+1} =$ radiationSolveTRBDF2($\U^{n-1},\U^n,\U^k,\dt$)
{
   $\tilde{Q}^{\pm,k} =$ computeTRBDF2Source($\U^{n-1},\U^n,\U^k,\dt$)
   $\R^{k+1} =$ radiationSolveSS($\sigma^k,\tilde{Q}^{\pm,k},\alpha^{TR/BDF-2}$)
}
\end{lstlisting}


\end{document}
